{% extends "base.html"%}
{% load i18n %}
{% block extrahead %}{{ block.super }}
<script type="text/javascript" src="{{MEDIA_URL}}/frameworks/jquery/jquery.tools.min.js"></script>
<script type="text/javascript" src="{{MEDIA_URL}}frameworks/jquery.formset/jquery.formset.min.js"></script>
<script type="text/javascript">	
$(function() {
	$('fieldset.module .form-row').formset({ 
		prefix: '{{ formset.prefix }}',
		deleteText: '',
		addText: '',
		addCssClass: 'icon icon-orange ui-icon-circle-plus'
	});
})

$(function(){ 
	$('form[enctype=multipart/form-data]').submit(function(){ 
	  	$("#progress").overlay({ 
	    	top: 272, 
	    	api: true,
			closeOnClick: false,
			closeOnEsc: false, 
			expose: { 
	        	color: '#333', 
	        	loadSpeed: 1000, 
	        	opacity: 0.9 
		    }, 
		}).load();
	});
});

 $(document).ready(function(){
 	$("#help_icon").tooltip({
		position:  "center left"
	});
 })

</script>
{% endblock %}
{% block breadcrumbs %} {{block.super}} > <a href={% url task_detail task_id=task.id%}>{{task.title}}</a> > My solutions{% endblock %}

{% block content %}<div id='soluion_upload'>

<h1>{{task.title}}</h1>

<div class='left'>
	{% if not task.expired %}
		<a>{%trans "Time left:" %} {{ task.submission_date|timeuntil }}</a>
		<h2>{%trans "Upload solution" %}</h2>
		<form enctype="multipart/form-data" method="post" action="" > {% csrf_token %}
			{% include "forms/formset_as_div.html" %}
			<input type="submit" value="upload" />
		</form>
	{% else %}
		<h2>{%trans "Upload solution" %}</h2> 
		{%trans "The deadline has past. Therefore (re)submission is not possible." %}
	{% endif %}
</div>

<div class='right'>
	<div id='help_icon'><span class="icon icon-orange ui-icon-info"></span></div>
	<div class="tooltip"> 
    	<span class="icon ui-icon-bullet icon-red"></span> <a>Errors</a><br/>
		<span class="icon ui-icon-bullet icon-orange"></span> <a>Warnings</a><br/> 
		<span class="icon ui-icon-bullet icon-green"></span> <a>No Warnings</a><br/>  		
		<span class="icon ui-icon-script"></span> <a>Attest</a><br/> 
	</div> 
	<h2>{% trans "Final Solution" %}</h2>
	{% for solution in solutions %}
		<div class='solution'>
			{% spaceless %} 
				{% if solution.accepted%}
					{% if solution.warnings%}
						<span class="icon ui-icon-bullet icon-orange" title='Warnings'></span>
					{% else %}
						<span class="icon ui-icon-bullet icon-green" title='No Warnings'></span>
					{% endif %}
				{% else %}
					<span class="icon ui-icon-bullet icon-red" title='Errors'></span>
				{% endif %}
				<a href="{% url solution_detail solution_id=solution.id %}">Solution {{solution.number}}</a> <span> ({{solution.creation_date|timesince}} ago)</span>
				<br/>
			{% endspaceless %}
		</div>
		
		{% for attest in solution.attestation_set.all %}
			<div class='attestation'>
				{% if attest.published %}
					<span class="icon ui-icon-script" title='Attest'></span><a href={% url view_attestation attestation_id=attest.id%}>Attestation</a> by {{attest.author.get_full_name}}<br/>
				{% endif %}
			</div>
		{%endfor%}	
		{% if forloop.first %}
			<h2>{% trans "Solution History" %}</h2>
		{% endif %}	
	{% empty %}
		{%trans "You have't uploaded any solutions jet." %}
	{%endfor%}
</div>

<div class="simple_overlay" id="progress"> 
	<!-- spinner from http://ajaxload.info/ -->
	<img id="spinner" src="{{MEDIA_URL}}/images/loading.gif" alt="loading" />
    <p>Please wait while your solution is examined.</p>
</div> 

</div>{% endblock %}
