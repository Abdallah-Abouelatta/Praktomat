<Macro Praktomat $id $path $proccount>
    # WSGI setup
    # Make sure we're running Praktomat as user "praktomat", so file-permissions fit
    # We are not using threading, as some parts are not threadsafe (e.g. pygment)
    WSGIDaemonProcess local user=praktomat group=praktomat processes=$proccount threads=1 display-name=$id_Praktomat_Apache

    # Open this to test if we're really in daemon Mode
    # You may need to set the correct python path in testdaemon.wsgi beforehand
    # WSGIScriptAlias /testdaemon $path/Praktomat/documentation/testdaemon.wsgi

    WSGIScriptAlias /$id  $path/Praktomat/wsgi/praktomat.wsgi


    # The installation directory
    <Directory $path/Praktomat/>
                # Apache 2.2
                # Order allow,deny
                # allow from all

                # Apache 2.4
                Require all granted
    </Directory>

    # Depending on the version of apache(?), the following might be necessary
    # to get correct relative URLs for http://.../id (no trailing slashes)
    # RewriteRule ^/$id$ /$id/ [R=301]

    Alias /$id/static/ $path/static/
    WSGIScriptAlias /$id  $path/Praktomat/wsgi/praktomat.wsgi process-group=local

    <Location /$id>
         WSGIProcessGroup praktomat_$id
    </Location>

    <Directory $path/static/>
                # Apache 2.2
                # Order allow,deny
                # allow from all

                # Apache 2.4
                Require all granted
    </Directory>

    <Directory $path/work/>
                # Apache 2.2
                # Order allow,deny
                # allow from all

                # Apache 2.4
                Require all granted

    </Directory>

   # RH: try, but not work as I think: https://github.com/johnsensible/django-sendfile
   # RewriteEngine On
    # see if we're on an internal redirect or not
   # RewriteCond %{THE_REQUEST} ^[\S]+\ /upload/
   # RewriteRule ^/upload/ - [F]


    # We're using xsendfile
    <Location /$id/upload/ >
#    <Directory /$id/upload/ >
        XSendFile on
        #XSendFilePath $path/PraktomatSupport/
        XSendFilePath $path/work/
    </Location>
#    </Directory>

    #Alias /$id/upload/jplag/ $path/work/jplag/

    # This enables shibboleth support
    <Location /$id/accounts/shib_login>
        Order deny,allow
        Allow from all
        AuthType shibboleth
        ShibRequireSession On
        Require valid-user
        Satisfy all
    </Location>
</Macro>

<VirtualHost *:80>
	ServerAdmin webmaster@localhost
        ServerName praktomat.localhost
        #semi old way to activate a praktomat instance for apache
        #Use Praktomat 2014_SS  /srv/praktomat/2014_SS/

        #new way to activate a praktomat instance for apache:
        # parameter one is used to create the Name for WSGIProcessGroup and the display-name for WSGIDaemonProcess, with it you can differentiate between instances i.e. while looking on htop.
        # parameter two is the path where the repository had been cloned or copied to.
        # parameter three is the number of processes used by that instance.
        Use Praktomat 2020w_ap  /srv/praktomat/2021ws   30
</VirtualHost>

